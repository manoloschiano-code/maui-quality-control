<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maui Poke - Quality Control System 2.0</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        :root {
            --primary: #005AA7;
            --secondary: #FC6A57;
            --success: #00C896;
            --warning: #FFB800;
            --danger: #FF3B3B;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-dark: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gradient-dark);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Animated Background */
        .animated-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(270deg, #005AA7, #FC6A57, #00C896, #764ba2);
            background-size: 800% 800%;
            animation: gradientShift 15s ease infinite;
            opacity: 0.1;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Floating Particles */
        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            from {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            to {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0;
            }
        }
        
        /* Login Screen Styles */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 0;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: slideUp 0.8s ease;
        }
        
        .login-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .login-header h1 {
            font-size: 2.5em;
            font-weight: 900;
            margin: 0 0 10px 0;
            letter-spacing: -1px;
        }
        
        .login-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .login-form {
            padding: 40px 30px;
        }
        
        .login-form h2 {
            color: var(--dark);
            margin: 0 0 30px 0;
            text-align: center;
            font-size: 1.5em;
        }
        
        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 90, 167, 0.3);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        .error-message {
            background: rgba(255, 59, 59, 0.1);
            color: var(--danger);
            padding: 12px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .login-footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
        
        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }
        
        .user-info span {
            color: white;
            font-weight: 600;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px);
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
            position: relative;
        }
        
        /* Header Update */
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.8s ease;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .header h1 {
            font-size: 3.5em;
            font-weight: 900;
            background: linear-gradient(135deg, #fff 0%, #FC6A57 50%, #00C896 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -2px;
            position: relative;
            z-index: 1;
            animation: glow 3s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(252, 106, 87, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(252, 106, 87, 0.8)); }
        }
        
        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2em;
            font-weight: 300;
            position: relative;
            z-index: 1;
        }
        
        /* Store Selector */
        .store-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.8s ease 0.2s both;
        }
        
        .store-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .store-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .store-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .store-card:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .store-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        
        .store-card.selected {
            background: linear-gradient(135deg, var(--success), #00a878);
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 200, 150, 0.4);
        }
        
        .store-card.selected::after {
            content: '✓';
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 1.5em;
        }
        
        /* Form Sections */
        .form-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.8s ease both;
            position: relative;
            overflow: hidden;
        }
        
        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-1);
            animation: colorWave 3s ease-in-out infinite;
        }
        
        @keyframes colorWave {
            0%, 100% { background: var(--gradient-1); }
            33% { background: var(--gradient-2); }
            66% { background: var(--gradient-3); }
        }
        
        .form-section h3 {
            color: var(--dark);
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-1);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            animation: iconFloat 3s ease-in-out infinite;
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Advanced Rating System */
        .rating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .rating-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .rating-item::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(252, 106, 87, 0.1) 0%, transparent 70%);
            transition: all 0.5s;
        }
        
        .rating-item:hover::before {
            top: -150%;
            left: -150%;
        }
        
        .rating-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }
        
        .rating-item label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            display: block;
            font-size: 1.1em;
        }
        
        /* Grade Buttons System */
        .grade-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            position: relative;
            padding-right: 40px;
        }
        
        .grade-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .grade-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }
        
        .grade-btn[data-value="5"] {
            color: var(--success);
            border-color: var(--success);
        }
        
        .grade-btn[data-value="5"]:hover,
        .grade-btn[data-value="5"].active {
            background: var(--success);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 200, 150, 0.3);
        }
        
        .grade-btn[data-value="4"] {
            color: #4CAF50;
            border-color: #4CAF50;
        }
        
        .grade-btn[data-value="4"]:hover,
        .grade-btn[data-value="4"].active {
            background: #4CAF50;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .grade-btn[data-value="3"] {
            color: var(--warning);
            border-color: var(--warning);
        }
        
        .grade-btn[data-value="3"]:hover,
        .grade-btn[data-value="3"].active {
            background: var(--warning);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 184, 0, 0.3);
        }
        
        .grade-btn[data-value="2"] {
            color: #FF9800;
            border-color: #FF9800;
        }
        
        .grade-btn[data-value="2"]:hover,
        .grade-btn[data-value="2"].active {
            background: #FF9800;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }
        
        .grade-btn[data-value="1"] {
            color: var(--danger);
            border-color: var(--danger);
        }
        
        .grade-btn[data-value="1"]:hover,
        .grade-btn[data-value="1"].active {
            background: var(--danger);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 59, 59, 0.3);
        }
        
        .grade-btn.active::before {
            background: rgba(255, 255, 255, 0.3);
            width: 100px;
            height: 100px;
        }
        
        /* Clear Rating Button */
        .clear-rating-btn {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 35px;
            height: 35px;
            border: 2px solid #ddd;
            border-radius: 50%;
            background: white;
            color: #666;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .clear-rating-btn:hover {
            border-color: var(--danger);
            color: var(--danger);
            transform: translateY(-50%) rotate(180deg);
            background: rgba(255, 59, 59, 0.1);
        }
        
        .clear-rating-btn:active {
            transform: translateY(-50%) rotate(360deg) scale(0.9);
        }
        
        /* Helper Text */
        .rating-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .rating-item::after {
            content: 'Clicca di nuovo per annullare';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75em;
            color: #999;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .rating-item:hover::after {
            opacity: 1;
        }
        
        /* Modern Input Styles */
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid transparent;
            border-radius: 15px;
            font-size: 1em;
            background: #f8f9fa;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 5px 20px rgba(0, 90, 167, 0.2);
            transform: translateY(-2px);
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* Progress Indicator */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-1);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Submit Button */
        .submit-section {
            text-align: center;
            margin: 40px 0;
            animation: slideUp 0.8s ease 0.6s both;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 1.3em;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.4s;
            box-shadow: 0 10px 30px rgba(0, 90, 167, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .submit-btn:hover::before {
            width: 400px;
            height: 400px;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 50px rgba(0, 90, 167, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .submit-btn.loading {
            animation: pulse 1.5s infinite;
        }
        
        /* Dashboard Section */
        .dashboard {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 35px;
            margin-top: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.8s ease 0.8s both;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Chart Container */
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin-top: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        #performanceChart {
            max-width: 100%;
            height: 300px;
        }
        
        /* Report Cards */
        .reports-grid {
            display: grid;
            gap: 20px;
            margin-top: 25px;
        }
        
        .report-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-left: 5px solid;
            animation: slideRight 0.5s ease both;
        }
        
        .report-card:hover {
            transform: translateX(10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        
        .report-card.excellent { border-left-color: var(--success); }
        .report-card.good { border-left-color: var(--warning); }
        .report-card.poor { border-left-color: var(--danger); }
        
        .report-info h4 {
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 1.2em;
        }
        
        .report-meta {
            color: #666;
            font-size: 0.9em;
        }
        
        .report-score {
            font-size: 2em;
            font-weight: 900;
            padding: 15px;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            text-align: center;
            animation: successPop 0.5s ease forwards;
        }
        
        @keyframes successPop {
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--success) 0%, #00a878 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 3em;
            color: white;
            animation: checkmark 0.8s ease 0.3s both;
        }
        
        @keyframes checkmark {
            0% { transform: scale(0) rotate(0); }
            50% { transform: scale(1.2) rotate(360deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        
        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1999;
            display: none;
        }
        
        .overlay.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideRight {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }
            
            .store-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .rating-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .submit-btn {
                padding: 18px 40px;
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .form-section {
                padding: 25px 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <div class="particles" id="particles"></div>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
    
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-container">
            <div class="login-box">
                <div class="login-header">
                    <h1>MAUI POKE</h1>
                    <p>Sistema Controllo Qualità</p>
                </div>
                <div class="login-form">
                    <h2>Accesso Riservato</h2>
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Inserisci username" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Inserisci password" autocomplete="current-password">
                    </div>
                    <button type="button" class="login-btn" onclick="handleLogin()">ACCEDI</button>
                    <div id="loginError" class="error-message" style="display: none;">
                        Username o password non validi
                    </div>
                </div>
                <div class="login-footer">
                    <p>© 2024 Maui Poke - Quality Control System</p>
                </div>
            </div>
        </div>
        
        <!-- Main Application (hidden by default) -->
        <div id="mainApp" style="display: none;">
            <div class="header">
                <h1>MAUI POKE</h1>
                <p>Sistema Controllo Qualità - Rete Store</p>
                <div class="user-info">
                    <span id="currentUser"></span>
                    <button onclick="handleLogout()" class="logout-btn">Esci</button>
                </div>
            </div>
        
        <div class="store-selector">
            <h3 style="color: var(--dark); margin-bottom: 20px; font-size: 1.5em;">📍 Seleziona Store</h3>
            <div class="store-grid">
                <div class="store-card" data-store="Locarno">Locarno</div>
                <div class="store-card" data-store="Lugano">Lugano</div>
                <div class="store-card" data-store="Grancia">Grancia</div>
                <div class="store-card" data-store="Lido">Lido</div>
                <div class="store-card" data-store="Lugano Centro">Lugano Centro</div>
                <div class="store-card" data-store="Mendrisio">Mendrisio</div>
            </div>
        </div>
        
        <form id="qualityForm">
            <div class="form-section">
                <h3>
                    <div class="section-icon">ℹ️</div>
                    Informazioni Generali
                </h3>
                <div class="form-group">
                    <label for="inspector">Nome Ispettore</label>
                    <input type="text" id="inspector" name="inspector" required placeholder="Inserisci il tuo nome">
                </div>
                <div class="form-group">
                    <label for="date">Data Ispezione</label>
                    <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="time">Ora Ispezione</label>
                    <input type="time" id="time" name="time" required>
                </div>
                <div class="form-group">
                    <label for="personale">Personale in Servizio</label>
                    <textarea id="personale" name="personale" placeholder="Elenca il personale presente durante l'ispezione"></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>
                    <div class="section-icon">🧹</div>
                    Valutazione Pulizia
                </h3>
                <div class="rating-grid">
                    <div class="rating-item">
                        <label>Pulizia Generale</label>
                        <div class="grade-buttons" data-field="pulizia_generale">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Bancone e Superfici</label>
                        <div class="grade-buttons" data-field="pulizia_bancone">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Pavimenti</label>
                        <div class="grade-buttons" data-field="pulizia_pavimenti">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Servizi Igienici</label>
                        <div class="grade-buttons" data-field="pulizia_bagni">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="pulizia_note">Note e Osservazioni</label>
                    <textarea id="pulizia_note" name="pulizia_note" placeholder="Dettagli specifici sulla pulizia..."></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>
                    <div class="section-icon">👥</div>
                    Comportamento Staff
                </h3>
                <div class="rating-grid">
                    <div class="rating-item">
                        <label>Cortesia</label>
                        <div class="grade-buttons" data-field="staff_cortesia">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Professionalità</label>
                        <div class="grade-buttons" data-field="staff_professionalita">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Velocità Servizio</label>
                        <div class="grade-buttons" data-field="staff_velocita">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Conoscenza Prodotti</label>
                        <div class="grade-buttons" data-field="staff_conoscenza">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="staff_note">Note e Osservazioni</label>
                    <textarea id="staff_note" name="staff_note" placeholder="Dettagli sul comportamento dello staff..."></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>
                    <div class="section-icon">🥗</div>
                    Freschezza Ingredienti
                </h3>
                <div class="rating-grid">
                    <div class="rating-item">
                        <label>Pesce e Proteine</label>
                        <div class="grade-buttons" data-field="fresh_pesce">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Verdure</label>
                        <div class="grade-buttons" data-field="fresh_verdure">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Riso e Cereali</label>
                        <div class="grade-buttons" data-field="fresh_riso">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Salse e Condimenti</label>
                        <div class="grade-buttons" data-field="fresh_salse">
                            <button type="button" class="grade-btn" data-value="5">5</button>
                            <button type="button" class="grade-btn" data-value="4">4</button>
                            <button type="button" class="grade-btn" data-value="3">3</button>
                            <button type="button" class="grade-btn" data-value="2">2</button>
                            <button type="button" class="grade-btn" data-value="1">1</button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="fresh_note">Note e Osservazioni</label>
                    <textarea id="fresh_note" name="fresh_note" placeholder="Dettagli sulla freschezza degli ingredienti..."></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>
                    <div class="section-icon">📝</div>
                    Valutazione Finale
                </h3>
                <div class="form-group">
                    <label for="valutazione_finale">Voto Complessivo (1-10)</label>
                    <select id="valutazione_finale" name="valutazione_finale" required>
                        <option value="">Seleziona un voto...</option>
                        <option value="10">10 - Eccellente</option>
                        <option value="9">9 - Ottimo</option>
                        <option value="8">8 - Molto Buono</option>
                        <option value="7">7 - Buono</option>
                        <option value="6">6 - Sufficiente</option>
                        <option value="5">5 - Insufficiente</option>
                        <option value="4">4 - Scarso</option>
                        <option value="3">3 - Molto Scarso</option>
                        <option value="2">2 - Pessimo</option>
                        <option value="1">1 - Inaccettabile</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="note_finali">Note Generali e Raccomandazioni</label>
                    <textarea id="note_finali" name="note_finali" placeholder="Osservazioni finali e suggerimenti per il miglioramento..."></textarea>
                </div>
            </div>
            
            <div class="submit-section">
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="btnText">INVIA REPORT</span>
                </button>
            </div>
        </form>
        
        <div class="dashboard">
            <h3 style="color: var(--dark); margin-bottom: 30px; font-size: 1.8em;">📊 Dashboard Analytics</h3>
            
            <!-- Month Filter -->
            <div class="month-filter" style="margin-bottom: 30px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <label for="monthSelect" style="font-weight: 600; margin-right: 15px; color: var(--dark);">📅 Seleziona Periodo:</label>
                <select id="monthSelect" style="padding: 10px 20px; border-radius: 10px; border: 2px solid #ddd; font-size: 1em; min-width: 200px;">
                    <option value="all">Tutti i Report</option>
                </select>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="stat-number" id="totalReports">0</div>
                    <div class="stat-label">Report Totali</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="stat-number" id="avgScore">0.0</div>
                    <div class="stat-label">Media Voti</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="stat-number" id="bestStore">-</div>
                    <div class="stat-label">Miglior Store</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <div class="stat-number" id="worstStore">-</div>
                    <div class="stat-label">Da Migliorare</div>
                </div>
            </div>
            
            <!-- Monthly Summary -->
            <div id="monthlySummary" style="display: none; background: white; padding: 25px; border-radius: 20px; margin: 30px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: var(--dark); margin-bottom: 20px;">📈 Riepilogo Mensile</h4>
                <div id="monthlySummaryContent"></div>
            </div>
            
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
            
            <h4 style="color: var(--dark); margin: 30px 0 20px; font-size: 1.4em;">📝 Report del Periodo</h4>
            <div class="reports-grid" id="recentReports">
                <p style="text-align: center; color: #999;">Nessun report disponibile</p>
            </div>
        </div>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    <div class="success-message" id="successMessage" style="display: none;">
        <div class="success-icon">✓</div>
        <h2 style="color: var(--dark); margin-bottom: 10px;">Report Inviato!</h2>
        <p style="color: #666;">Il report è stato salvato e inviato con successo.</p>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // Initialize EmailJS
        emailjs.init("azBz9PrKR4ljQuq93");
        
        // User Authentication
        const USERS = {
            'admin': { password: 'MauiPoke2024!', role: 'Administrator', name: 'Amministratore' },
            'manolo': { password: 'Maui@Quality24', role: 'Manager', name: 'Manolo Schiano' },
            'antonello': { password: 'Poke@Control24', role: 'Manager', name: 'Antonello Romeo' },
            'luigi': { password: 'Luigi@Maui24', role: 'Manager', name: 'Luigi' },
            'rocco': { password: 'Rocco@Poke24', role: 'Inspector', name: 'Rocco' },
            'inspector1': { password: 'Quality@2024', role: 'Inspector', name: 'Ispettore 1' },
            'inspector2': { password: 'Control@2024', role: 'Inspector', name: 'Ispettore 2' }
        };
        
        let currentUser = null;
        
        // Check if user is already logged in
        function checkAuth() {
            const savedSession = sessionStorage.getItem('mauiUser');
            if (savedSession) {
                currentUser = JSON.parse(savedSession);
                showMainApp();
            }
        }
        
        // Handle Login
        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            if (!username || !password) {
                errorDiv.textContent = 'Inserisci username e password';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (USERS[username] && USERS[username].password === password) {
                currentUser = {
                    username: username,
                    name: USERS[username].name,
                    role: USERS[username].role
                };
                
                // Save session
                sessionStorage.setItem('mauiUser', JSON.stringify(currentUser));
                
                // Show main app
                showMainApp();
                
                // Clear login form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                errorDiv.style.display = 'none';
            } else {
                errorDiv.textContent = 'Username o password non validi';
                errorDiv.style.display = 'block';
                
                // Shake animation
                const loginBox = document.querySelector('.login-box');
                loginBox.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    loginBox.style.animation = '';
                }, 500);
            }
        }
        
        // Show Main Application
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentUser').textContent = `👤 ${currentUser.name}`;
            
            // Set inspector name automatically
            if (document.getElementById('inspector')) {
                document.getElementById('inspector').value = currentUser.name;
            }
            
            // Initialize app
            initializeApp();
        }
        
        // Handle Logout
        function handleLogout() {
            if (confirm('Sei sicuro di voler uscire?')) {
                currentUser = null;
                sessionStorage.removeItem('mauiUser');
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
            }
        }
        
        // Enter key support for login
        document.addEventListener('DOMContentLoaded', function() {
            const passwordField = document.getElementById('password');
            const usernameField = document.getElementById('username');
            
            if (passwordField) {
                passwordField.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleLogin();
                    }
                });
            }
            
            if (usernameField) {
                usernameField.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('password').focus();
                    }
                });
            }
            
            // Check authentication on load
            checkAuth();
        });
        
        // State Management
        let selectedStore = '';
        let ratings = {};
        let reports = JSON.parse(localStorage.getItem('mauiReports') || '[]');
        
        // Initialize App (called after login)
        function initializeApp() {
            initializeParticles();
            initializeDateTime();
            initializeStoreSelector();
            initializeRatings();
            initializeForm();
            updateDashboard();
            updateProgressBar();
        }
        
        // Modify the original DOMContentLoaded to not auto-initialize
        window.addEventListener('load', function() {
            // Only initialize particles for visual effect
            initializeParticles();
        });
        
        // Particles Animation
        function initializeParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // DateTime
        function initializeDateTime() {
            const now = new Date();
            document.getElementById('date').valueAsDate = now;
            document.getElementById('time').value = now.toTimeString().slice(0, 5);
        }
        
        // Store Selector
        function initializeStoreSelector() {
            document.querySelectorAll('.store-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.store-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedStore = this.dataset.store;
                    updateProgressBar();
                });
            });
        }
        
        // Grade Ratings
        function initializeRatings() {
            document.querySelectorAll('.grade-buttons').forEach(gradeGroup => {
                const field = gradeGroup.dataset.field;
                const buttons = gradeGroup.querySelectorAll('.grade-btn');
                
                buttons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Check if this button is already active
                        if (this.classList.contains('active')) {
                            // Deselect if clicking on already selected button
                            this.classList.remove('active');
                            delete ratings[field];
                            
                            // Visual feedback for deselection
                            this.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                this.style.transform = '';
                            }, 100);
                        } else {
                            // Remove active class from all buttons in this group
                            buttons.forEach(btn => btn.classList.remove('active'));
                            
                            // Add active class to clicked button
                            this.classList.add('active');
                            
                            // Store the rating value
                            const value = parseInt(this.dataset.value);
                            ratings[field] = value;
                            
                            // Visual feedback for selection
                            this.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                this.style.transform = '';
                            }, 100);
                        }
                        
                        // Update progress and auto-calculate score
                        updateProgressBar();
                        calculateAutoScore();
                    });
                    
                    // Add double-click to clear
                    button.addEventListener('dblclick', function(e) {
                        e.preventDefault();
                        buttons.forEach(btn => btn.classList.remove('active'));
                        delete ratings[field];
                        updateProgressBar();
                        calculateAutoScore();
                    });
                });
                
                // Add clear button for each rating group
                const clearBtn = document.createElement('button');
                clearBtn.className = 'clear-rating-btn';
                clearBtn.innerHTML = '↻';
                clearBtn.title = 'Annulla valutazione';
                clearBtn.onclick = function() {
                    buttons.forEach(btn => btn.classList.remove('active'));
                    delete ratings[field];
                    updateProgressBar();
                    calculateAutoScore();
                };
                gradeGroup.appendChild(clearBtn);
            });
        }
        
        function updateStars(ratingElement, value) {
            // Not used anymore, keeping for compatibility
        }
        
        // Auto Calculate Score
        function calculateAutoScore() {
            const ratingValues = Object.values(ratings);
            if (ratingValues.length > 0) {
                const avg = ratingValues.reduce((a, b) => a + b, 0) / ratingValues.length;
                const score = Math.round(avg * 2);
                document.getElementById('valutazione_finale').value = score;
            }
        }
        
        // Progress Bar
        function updateProgressBar() {
            const totalFields = 17; // Total fields to complete
            let completed = 0;
            
            if (selectedStore) completed++;
            if (document.getElementById('inspector').value) completed++;
            if (document.getElementById('date').value) completed++;
            if (document.getElementById('time').value) completed++;
            completed += Object.keys(ratings).length;
            if (document.getElementById('valutazione_finale').value) completed++;
            
            const progress = (completed / totalFields) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }
        
        // Form Submission
        function initializeForm() {
            document.getElementById('qualityForm').addEventListener('submit', handleSubmit);
            
            // Update progress on input
            document.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('input', updateProgressBar);
            });
        }
        
        function handleSubmit(e) {
            e.preventDefault();
            
            if (!selectedStore) {
                alert('Seleziona uno store!');
                return;
            }
            
            const btn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            
            btn.classList.add('loading');
            btnText.textContent = 'INVIO IN CORSO...';
            btn.disabled = true;
            
            const formData = new FormData(e.target);
            const report = {
                id: Date.now(),
                store: selectedStore,
                date: formData.get('date'),
                time: formData.get('time'),
                inspector: currentUser.name, // Use logged in user name
                personale: formData.get('personale'),
                ratings: {...ratings},
                score: formData.get('valutazione_finale'),
                notes: {
                    pulizia: formData.get('pulizia_note'),
                    staff: formData.get('staff_note'),
                    fresh: formData.get('fresh_note'),
                    final: formData.get('note_finali')
                },
                submittedBy: currentUser.username // Track who submitted
            };
            
            // Save report
            reports.push(report);
            localStorage.setItem('mauiReports', JSON.stringify(reports));
            
            // Send email
            sendEmail(report);
            
            // Show success
            setTimeout(() => {
                showSuccess();
                resetForm();
                updateDashboard();
                btn.classList.remove('loading');
                btnText.textContent = 'INVIA REPORT';
                btn.disabled = false;
            }, 1500);
        }
        
        function sendEmail(report) {
            const ratingToText = (value) => {
                const grades = { 5: '5 - Eccellente', 4: '4 - Buono', 3: '3 - Sufficiente', 2: '2 - Scarso', 1: '1 - Inaccettabile' };
                return grades[value] || 'Non valutato';
            };
            
            // Prepara tutti i parametri per il template EmailJS
            const templateParams = {
                to_email: 'manolo.schiano@mauipoke.ch',
                cc_email: 'antonello.romeo@mauipoke.ch',
                subject: `Quality Report - ${report.store} - ${new Date(report.date).toLocaleDateString('it-IT')}`,
                
                // Dati base
                store_name: report.store,
                inspector_name: report.inspector,
                report_date: new Date(report.date).toLocaleDateString('it-IT'),
                report_time: report.time,
                overall_score: report.score,
                personale: report.personale || 'Non specificato',
                
                // Valutazioni Pulizia
                pulizia_generale: ratingToText(report.ratings.pulizia_generale),
                pulizia_bancone: ratingToText(report.ratings.pulizia_bancone),
                pulizia_pavimenti: ratingToText(report.ratings.pulizia_pavimenti),
                pulizia_bagni: ratingToText(report.ratings.pulizia_bagni),
                pulizia_note: report.notes.pulizia || 'Nessuna nota',
                
                // Valutazioni Staff
                staff_cortesia: ratingToText(report.ratings.staff_cortesia),
                staff_professionalita: ratingToText(report.ratings.staff_professionalita),
                staff_velocita: ratingToText(report.ratings.staff_velocita),
                staff_conoscenza: ratingToText(report.ratings.staff_conoscenza),
                staff_note: report.notes.staff || 'Nessuna nota',
                
                // Valutazioni Freschezza
                fresh_pesce: ratingToText(report.ratings.fresh_pesce),
                fresh_verdure: ratingToText(report.ratings.fresh_verdure),
                fresh_riso: ratingToText(report.ratings.fresh_riso),
                fresh_salse: ratingToText(report.ratings.fresh_salse),
                fresh_note: report.notes.fresh || 'Nessuna nota',
                
                // Note finali
                note_finali: report.notes.final || 'Nessuna nota generale'
            };
            
            // Invia con EmailJS usando il template con variabili
            emailjs.send('service_cysrzkx', 'template_j203617', templateParams)
                .then(() => {
                    console.log('Email sent successfully with parameters');
                })
                .catch(error => {
                    console.error('EmailJS error:', error);
                    // Fallback: apri client email con il report formattato
                    const emailBody = formatEmailBody(report);
                    const subject = encodeURIComponent(templateParams.subject);
                    const body = encodeURIComponent(emailBody);
                    window.open(`mailto:${templateParams.to_email},${templateParams.cc_email}?subject=${subject}&body=${body}`);
                });
        }
        
        function formatEmailBody(report) {
            const ratingToText = (value) => {
                const grades = { 5: '5 - Eccellente', 4: '4 - Buono', 3: '3 - Sufficiente', 2: '2 - Scarso', 1: '1 - Inaccettabile' };
                return grades[value] || 'Non valutato';
            };
            
            return `
MAUI POKE - QUALITY CONTROL REPORT
═══════════════════════════════════════

📍 STORE: ${report.store}
👤 ISPETTORE: ${report.inspector}
📅 DATA: ${new Date(report.date).toLocaleDateString('it-IT')} ${report.time}
${report.personale ? `👥 PERSONALE: ${report.personale}` : ''}

⭐ VOTO COMPLESSIVO: ${report.score}/10

🧹 PULIZIA
─────────────────────────
• Generale: ${ratingToText(report.ratings.pulizia_generale)}
• Bancone: ${ratingToText(report.ratings.pulizia_bancone)}
• Pavimenti: ${ratingToText(report.ratings.pulizia_pavimenti)}
• Bagni: ${ratingToText(report.ratings.pulizia_bagni)}
${report.notes.pulizia ? `📝 Note: ${report.notes.pulizia}` : ''}

👥 STAFF
─────────────────────────
• Cortesia: ${ratingToText(report.ratings.staff_cortesia)}
• Professionalità: ${ratingToText(report.ratings.staff_professionalita)}
• Velocità: ${ratingToText(report.ratings.staff_velocita)}
• Conoscenza: ${ratingToText(report.ratings.staff_conoscenza)}
${report.notes.staff ? `📝 Note: ${report.notes.staff}` : ''}

🥗 FRESCHEZZA
─────────────────────────
• Pesce: ${ratingToText(report.ratings.fresh_pesce)}
• Verdure: ${ratingToText(report.ratings.fresh_verdure)}
• Riso: ${ratingToText(report.ratings.fresh_riso)}
• Salse: ${ratingToText(report.ratings.fresh_salse)}
${report.notes.fresh ? `📝 Note: ${report.notes.fresh}` : ''}

${report.notes.final ? `📋 NOTE FINALI\n─────────────────────────\n${report.notes.final}` : ''}

═══════════════════════════════════════
🤖 Report generato automaticamente
📱 Maui Quality Control System
            `;
        }
        
        function showSuccess() {
            const overlay = document.getElementById('overlay');
            const successMsg = document.getElementById('successMessage');
            
            overlay.classList.add('active');
            successMsg.style.display = 'block';
            
            setTimeout(() => {
                overlay.classList.remove('active');
                successMsg.style.display = 'none';
            }, 3000);
        }
        
        function resetForm() {
            document.getElementById('qualityForm').reset();
            document.querySelectorAll('.store-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.grade-btn').forEach(b => b.classList.remove('active'));
            selectedStore = '';
            ratings = {};
            initializeDateTime();
            updateProgressBar();
        }
        
        // Dashboard
        function updateDashboard() {
            updateMonthFilter();
            const selectedMonth = document.getElementById('monthSelect').value;
            updateDashboardStats(selectedMonth);
            updateRecentReports(selectedMonth);
            updateChart(selectedMonth);
        }
        
        function updateMonthFilter() {
            const monthSelect = document.getElementById('monthSelect');
            const existingValue = monthSelect.value;
            
            // Get unique months from reports
            const months = [...new Set(reports.map(r => {
                const date = new Date(r.date);
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            }))].sort().reverse();
            
            // Clear and rebuild options
            monthSelect.innerHTML = '<option value="all">Tutti i Report</option>';
            
            const monthNames = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 
                              'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
            
            months.forEach(month => {
                const [year, monthNum] = month.split('-');
                const option = document.createElement('option');
                option.value = month;
                option.textContent = `${monthNames[parseInt(monthNum) - 1]} ${year}`;
                monthSelect.appendChild(option);
            });
            
            // Restore selection if it exists
            if (existingValue && [...monthSelect.options].some(opt => opt.value === existingValue)) {
                monthSelect.value = existingValue;
            }
            
            // Add change event listener
            monthSelect.onchange = () => updateDashboard();
        }
        
        function updateDashboardStats(selectedMonth = 'all') {
            let filteredReports = reports;
            
            if (selectedMonth !== 'all') {
                filteredReports = reports.filter(r => {
                    const date = new Date(r.date);
                    const reportMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    return reportMonth === selectedMonth;
                });
            }
            
            // Update total reports
            document.getElementById('totalReports').textContent = filteredReports.length;
            
            if (filteredReports.length > 0) {
                // Average score
                const avgScore = filteredReports.reduce((sum, r) => sum + parseInt(r.score || 0), 0) / filteredReports.length;
                document.getElementById('avgScore').textContent = avgScore.toFixed(1);
                
                // Store statistics
                const storeScores = {};
                filteredReports.forEach(r => {
                    if (!storeScores[r.store]) {
                        storeScores[r.store] = { total: 0, count: 0 };
                    }
                    storeScores[r.store].total += parseInt(r.score || 0);
                    storeScores[r.store].count++;
                });
                
                let bestStore = '';
                let worstStore = '';
                let bestAvg = 0;
                let worstAvg = 10;
                
                Object.keys(storeScores).forEach(store => {
                    const avg = storeScores[store].total / storeScores[store].count;
                    if (avg > bestAvg) {
                        bestAvg = avg;
                        bestStore = store;
                    }
                    if (avg < worstAvg) {
                        worstAvg = avg;
                        worstStore = store;
                    }
                });
                
                document.getElementById('bestStore').textContent = bestStore || '-';
                document.getElementById('worstStore').textContent = worstStore || '-';
                
                // Show monthly summary if month is selected
                if (selectedMonth !== 'all') {
                    showMonthlySummary(filteredReports, storeScores);
                } else {
                    document.getElementById('monthlySummary').style.display = 'none';
                }
            } else {
                document.getElementById('avgScore').textContent = '0.0';
                document.getElementById('bestStore').textContent = '-';
                document.getElementById('worstStore').textContent = '-';
                document.getElementById('monthlySummary').style.display = 'none';
            }
        }
        
        function showMonthlySummary(monthReports, storeScores) {
            const summaryDiv = document.getElementById('monthlySummary');
            const contentDiv = document.getElementById('monthlySummaryContent');
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">';
            
            Object.keys(storeScores).forEach(store => {
                const avg = (storeScores[store].total / storeScores[store].count).toFixed(1);
                const count = storeScores[store].count;
                const color = avg >= 8 ? 'var(--success)' : avg >= 6 ? 'var(--warning)' : 'var(--danger)';
                
                html += `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border-left: 4px solid ${color};">
                        <h5 style="margin: 0 0 10px 0; color: var(--dark);">${store}</h5>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 2em; font-weight: bold; color: ${color};">${avg}</span>
                            <span style="color: #666;">${count} report${count > 1 ? 's' : ''}</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            contentDiv.innerHTML = html;
            summaryDiv.style.display = 'block';
        }
        
        function updateRecentReports(selectedMonth = 'all') {
            const container = document.getElementById('recentReports');
            
            let filteredReports = reports;
            if (selectedMonth !== 'all') {
                filteredReports = reports.filter(r => {
                    const date = new Date(r.date);
                    const reportMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    return reportMonth === selectedMonth;
                });
            }
            
            if (filteredReports.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">Nessun report disponibile per questo periodo</p>';
                return;
            }
            
            // Sort by date and show all reports for the selected period
            const sortedReports = filteredReports.sort((a, b) => 
                new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time)
            );
            
            container.innerHTML = sortedReports.map(report => {
                const score = parseInt(report.score || 0);
                const scoreClass = score >= 8 ? 'excellent' : score >= 6 ? 'good' : 'poor';
                // Only Manolo can delete reports
                const canDelete = currentUser && currentUser.username === 'manolo';
                
                return `
                    <div class="report-card ${scoreClass}" data-report-id="${report.id}">
                        <div class="report-info">
                            <h4>${report.store}</h4>
                            <div class="report-meta">
                                ${new Date(report.date).toLocaleDateString('it-IT')} ${report.time} - ${report.inspector}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="report-score" style="color: ${score >= 8 ? 'var(--success)' : score >= 6 ? 'var(--warning)' : 'var(--danger)'}">
                                ${score}/10
                            </div>
                            <button class="view-report-btn" onclick="viewReportDetails(${report.id})" title="Visualizza dettagli">
                                👁️
                            </button>
                            <button class="resend-email-btn" onclick="resendReportEmail(${report.id})" title="Reinvia email">
                                📧
                            </button>
                            ${canDelete ? `
                                <button class="delete-report-btn" onclick="deleteReport(${report.id})" title="Elimina report">
                                    🗑️
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // View Report Details
        function viewReportDetails(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            const modal = document.createElement('div');
            modal.className = 'report-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>📋 Dettagli Report - ${report.store}</h2>
                        <button onclick="closeReportModal()" class="close-modal-btn">✕</button>
                    </div>
                    <div class="modal-body">
                        <div class="report-detail-section">
                            <h3>📍 Informazioni Generali</h3>
                            <div class="detail-grid">
                                <div><strong>Store:</strong> ${report.store}</div>
                                <div><strong>Data:</strong> ${new Date(report.date).toLocaleDateString('it-IT')}</div>
                                <div><strong>Ora:</strong> ${report.time}</div>
                                <div><strong>Ispettore:</strong> ${report.inspector}</div>
                                <div><strong>Personale:</strong> ${report.personale || 'Non specificato'}</div>
                                <div><strong>Voto Finale:</strong> <span class="score-badge">${report.score}/10</span></div>
                            </div>
                        </div>
                        
                        ${generateRatingSection('🧹 Pulizia', {
                            'Generale': report.ratings.pulizia_generale,
                            'Bancone': report.ratings.pulizia_bancone,
                            'Pavimenti': report.ratings.pulizia_pavimenti,
                            'Bagni': report.ratings.pulizia_bagni
                        }, report.notes?.pulizia)}
                        
                        ${generateRatingSection('👥 Staff', {
                            'Cortesia': report.ratings.staff_cortesia,
                            'Professionalità': report.ratings.staff_professionalita,
                            'Velocità': report.ratings.staff_velocita,
                            'Conoscenza': report.ratings.staff_conoscenza
                        }, report.notes?.staff)}
                        
                        ${generateRatingSection('🥗 Freschezza', {
                            'Pesce': report.ratings.fresh_pesce,
                            'Verdure': report.ratings.fresh_verdure,
                            'Riso': report.ratings.fresh_riso,
                            'Salse': report.ratings.fresh_salse
                        }, report.notes?.fresh)}
                        
                        ${report.notes?.final ? `
                            <div class="report-detail-section">
                                <h3>📝 Note Finali</h3>
                                <div class="notes-box">${report.notes.final}</div>
                            </div>
                        ` : ''}
                        
                        ${identifyProblems(report).length > 0 ? `
                            <div class="report-detail-section problems-section">
                                <h3>⚠️ Aree Critiche da Migliorare</h3>
                                <div class="problems-list">
                                    ${identifyProblems(report).map(problem => `
                                        <div class="problem-item">
                                            <span class="problem-icon">❗</span>
                                            <div>
                                                <strong>${problem.area}:</strong> ${problem.item} - Voto ${problem.score}/5
                                                ${problem.note ? `<br><small>📝 ${problem.note}</small>` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    <div class="modal-footer">
                        <button onclick="printReport(${reportId})" class="print-btn">🖨️ Stampa</button>
                        <button onclick="downloadReport(${reportId})" class="download-btn">💾 Scarica</button>
                        <button onclick="closeReportModal()" class="close-btn">Chiudi</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('active'), 10);
        }
        
        function generateRatingSection(title, ratings, notes) {
            return `
                <div class="report-detail-section">
                    <h3>${title}</h3>
                    <div class="rating-details">
                        ${Object.entries(ratings).map(([key, value]) => `
                            <div class="rating-row">
                                <span>${key}:</span>
                                <span class="rating-value ${getRatingClass(value)}">${getRatingText(value)}</span>
                            </div>
                        `).join('')}
                    </div>
                    ${notes ? `<div class="section-notes">📝 Note: ${notes}</div>` : ''}
                </div>
            `;
        }
        
        function getRatingClass(value) {
            if (value >= 5) return 'excellent';
            if (value >= 4) return 'good';
            if (value >= 3) return 'average';
            if (value >= 2) return 'poor';
            return 'critical';
        }
        
        function getRatingText(value) {
            const ratings = {
                5: '5 - Eccellente',
                4: '4 - Buono',
                3: '3 - Sufficiente',
                2: '2 - Scarso',
                1: '1 - Inaccettabile'
            };
            return ratings[value] || 'Non valutato';
        }
        
        function identifyProblems(report) {
            const problems = [];
            const categories = [
                { prefix: 'pulizia', area: 'Pulizia', items: {
                    'pulizia_generale': 'Generale',
                    'pulizia_bancone': 'Bancone',
                    'pulizia_pavimenti': 'Pavimenti',
                    'pulizia_bagni': 'Bagni'
                }},
                { prefix: 'staff', area: 'Staff', items: {
                    'staff_cortesia': 'Cortesia',
                    'staff_professionalita': 'Professionalità',
                    'staff_velocita': 'Velocità',
                    'staff_conoscenza': 'Conoscenza'
                }},
                { prefix: 'fresh', area: 'Freschezza', items: {
                    'fresh_pesce': 'Pesce',
                    'fresh_verdure': 'Verdure',
                    'fresh_riso': 'Riso',
                    'fresh_salse': 'Salse'
                }}
            ];
            
            categories.forEach(category => {
                Object.entries(category.items).forEach(([field, name]) => {
                    const score = report.ratings[field];
                    if (score && score <= 2) {
                        problems.push({
                            area: category.area,
                            item: name,
                            score: score,
                            note: report.notes?.[category.prefix.split('_')[0]]
                        });
                    }
                });
            });
            
            return problems.sort((a, b) => a.score - b.score);
        }
        
        function closeReportModal() {
            const modal = document.querySelector('.report-modal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        function printReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Report ${report.store} - ${new Date(report.date).toLocaleDateString('it-IT')}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #005AA7; }
                        .section { margin: 20px 0; }
                        .rating { margin: 5px 0; }
                        .critical { color: red; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <h1>MAUI POKE - Report Qualità</h1>
                    <h2>${report.store} - ${new Date(report.date).toLocaleDateString('it-IT')}</h2>
                    ${document.querySelector('.modal-body').innerHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        function downloadReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            const content = formatEmailBody(report);
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report_${report.store}_${report.date}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Resend Email Function
        function resendReportEmail(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = '⏳';
            
            // Resend email
            sendEmail(report);
            
            // Show success message
            setTimeout(() => {
                btn.textContent = '✅';
                setTimeout(() => {
                    btn.textContent = '📧';
                    btn.disabled = false;
                }, 2000);
                
                // Show notification
                const notification = document.createElement('div');
                notification.className = 'email-notification';
                notification.innerHTML = '✅ Email reinviata con successo!';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, var(--success) 0%, #00a878 100%);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    box-shadow: 0 10px 30px rgba(0, 200, 150, 0.3);
                    z-index: 3000;
                    animation: slideInRight 0.5s ease;
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.5s ease';
                    setTimeout(() => notification.remove(), 500);
                }, 3000);
            }, 1500);
        }
        
        // Delete Report Function
        function deleteReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            // Check permissions - Only Manolo can delete
            if (!currentUser || currentUser.username !== 'manolo') {
                alert('Solo Manolo Schiano ha i permessi per eliminare i report');
                return;
            }
            
            // Create custom confirmation modal
            const confirmModal = document.createElement('div');
            confirmModal.className = 'delete-confirm-modal';
            confirmModal.innerHTML = `
                <div class="delete-confirm-content">
                    <div class="delete-confirm-header">
                        <div class="warning-icon">⚠️</div>
                        <h2>Conferma Eliminazione Report</h2>
                    </div>
                    <div class="delete-confirm-body">
                        <p><strong>Stai per eliminare definitivamente questo report:</strong></p>
                        <div class="report-summary">
                            <div><strong>📍 Store:</strong> ${report.store}</div>
                            <div><strong>📅 Data:</strong> ${new Date(report.date).toLocaleDateString('it-IT')}</div>
                            <div><strong>⏰ Ora:</strong> ${report.time}</div>
                            <div><strong>👤 Ispettore:</strong> ${report.inspector}</div>
                            <div><strong>⭐ Voto:</strong> <span class="score-highlight">${report.score}/10</span></div>
                        </div>
                        <div class="warning-message">
                            <p>⚠️ <strong>ATTENZIONE:</strong></p>
                            <ul>
                                <li>Questa azione è <strong>IRREVERSIBILE</strong></li>
                                <li>Il report sarà eliminato <strong>PERMANENTEMENTE</strong></li>
                                <li>Non sarà possibile recuperare i dati</li>
                            </ul>
                        </div>
                        <div class="confirm-question">
                            <p><strong>Sei assolutamente sicuro di voler procedere?</strong></p>
                        </div>
                    </div>
                    <div class="delete-confirm-footer">
                        <button onclick="cancelDelete()" class="cancel-delete-btn">❌ Annulla</button>
                        <button onclick="confirmDelete(${reportId})" class="confirm-delete-btn">🗑️ Sì, Elimina Definitivamente</button>
                    </div>
                </div>
            `;
            
            // Add styles for the modal
            const modalStyles = `
                <style>
                .delete-confirm-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    backdrop-filter: blur(5px);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 5000;
                    animation: fadeIn 0.3s ease;
                }
                
                .delete-confirm-content {
                    background: white;
                    border-radius: 20px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
                    overflow: hidden;
                    animation: slideUp 0.3s ease;
                }
                
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                
                @keyframes slideUp {
                    from { 
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    to { 
                        transform: translateY(0);
                        opacity: 1;
                    }
                }
                
                .delete-confirm-header {
                    background: linear-gradient(135deg, #FF3B3B 0%, #FF6B6B 100%);
                    color: white;
                    padding: 25px;
                    text-align: center;
                }
                
                .warning-icon {
                    font-size: 3em;
                    animation: pulse 1.5s infinite;
                }
                
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.1); }
                }
                
                .delete-confirm-header h2 {
                    margin: 10px 0 0 0;
                    font-size: 1.5em;
                }
                
                .delete-confirm-body {
                    padding: 30px;
                }
                
                .report-summary {
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 10px;
                    margin: 20px 0;
                    border-left: 4px solid var(--primary);
                }
                
                .report-summary div {
                    margin: 8px 0;
                }
                
                .score-highlight {
                    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                    color: white;
                    padding: 3px 10px;
                    border-radius: 15px;
                    font-weight: bold;
                }
                
                .warning-message {
                    background: #fff3cd;
                    border: 2px solid #ffc107;
                    border-radius: 10px;
                    padding: 20px;
                    margin: 20px 0;
                }
                
                .warning-message p {
                    margin: 0 0 10px 0;
                    color: #856404;
                    font-weight: bold;
                }
                
                .warning-message ul {
                    margin: 0;
                    padding-left: 20px;
                    color: #856404;
                }
                
                .warning-message li {
                    margin: 5px 0;
                }
                
                .confirm-question {
                    text-align: center;
                    margin: 20px 0;
                }
                
                .confirm-question p {
                    font-size: 1.1em;
                    color: var(--danger);
                }
                
                .delete-confirm-footer {
                    display: flex;
                    gap: 15px;
                    padding: 20px 30px;
                    background: #f8f9fa;
                    justify-content: center;
                }
                
                .delete-confirm-footer button {
                    padding: 15px 30px;
                    border-radius: 10px;
                    border: none;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s;
                    font-size: 1em;
                }
                
                .cancel-delete-btn {
                    background: #28a745;
                    color: white;
                    flex: 1;
                }
                
                .cancel-delete-btn:hover {
                    background: #218838;
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
                }
                
                .confirm-delete-btn {
                    background: var(--danger);
                    color: white;
                    flex: 1;
                }
                
                .confirm-delete-btn:hover {
                    background: #dc3545;
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(255, 59, 59, 0.3);
                }
                </style>
            `;
            
            // Add styles if not already present
            if (!document.querySelector('#deleteModalStyles')) {
                const styleElement = document.createElement('div');
                styleElement.id = 'deleteModalStyles';
                styleElement.innerHTML = modalStyles;
                document.head.appendChild(styleElement);
            }
            
            document.body.appendChild(confirmModal);
        }
        
        // Cancel Delete Function
        function cancelDelete() {
            const modal = document.querySelector('.delete-confirm-modal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // Confirm Delete Function
        function confirmDelete(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            // Remove report from array
            const index = reports.findIndex(r => r.id === reportId);
            if (index > -1) {
                reports.splice(index, 1);
                
                // Save to localStorage
                localStorage.setItem('mauiReports', JSON.stringify(reports));
                
                // Close modal
                cancelDelete();
                
                // Show success message
                showDeleteSuccess();
                
                // Update dashboard
                updateDashboard();
            }
        }
        
        // Show delete success message
        function showDeleteSuccess() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'delete-success';
            messageDiv.innerHTML = '✅ Report eliminato con successo';
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--success) 0%, #00a878 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 200, 150, 0.3);
                z-index: 3000;
                animation: slideInRight 0.5s ease;
                font-weight: 600;
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => {
                    document.body.removeChild(messageDiv);
                }, 500);
            }, 3000);
        }
        
        // Add animation keyframes
        if (!document.querySelector('#deleteAnimations')) {
            const style = document.createElement('style');
            style.id = 'deleteAnimations';
            style.innerHTML = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                
                @keyframes slideOutRight {
                    from {
                        transform: translateX(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                }
                
                .delete-report-btn {
                    background: rgba(255, 59, 59, 0.1);
                    border: 2px solid var(--danger);
                    color: var(--danger);
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    cursor: pointer;
                    transition: all 0.3s;
                    font-size: 1.2em;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .delete-report-btn:hover {
                    background: var(--danger);
                    color: white;
                    transform: scale(1.1);
                    box-shadow: 0 5px 15px rgba(255, 59, 59, 0.3);
                }
                
                .delete-report-btn:active {
                    transform: scale(0.95);
                }
                
                .view-report-btn, .resend-email-btn {
                    background: rgba(0, 90, 167, 0.1);
                    border: 2px solid var(--primary);
                    color: var(--primary);
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    cursor: pointer;
                    transition: all 0.3s;
                    font-size: 1.2em;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .view-report-btn:hover {
                    background: var(--primary);
                    color: white;
                    transform: scale(1.1);
                    box-shadow: 0 5px 15px rgba(0, 90, 167, 0.3);
                }
                
                .resend-email-btn {
                    background: rgba(0, 200, 150, 0.1);
                    border: 2px solid var(--success);
                    color: var(--success);
                }
                
                .resend-email-btn:hover {
                    background: var(--success);
                    color: white;
                    transform: scale(1.1);
                    box-shadow: 0 5px 15px rgba(0, 200, 150, 0.3);
                }
                
                /* Report Modal Styles */
                .report-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.7);
                    backdrop-filter: blur(5px);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 4000;
                    opacity: 0;
                    transition: opacity 0.3s;
                    padding: 20px;
                }
                
                .report-modal.active {
                    opacity: 1;
                }
                
                .modal-content {
                    background: white;
                    border-radius: 25px;
                    max-width: 900px;
                    width: 100%;
                    max-height: 90vh;
                    overflow: hidden;
                    box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
                    display: flex;
                    flex-direction: column;
                    animation: modalSlideUp 0.3s ease;
                }
                
                @keyframes modalSlideUp {
                    from {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    to {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }
                
                .modal-header {
                    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                    color: white;
                    padding: 25px 30px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .modal-header h2 {
                    margin: 0;
                    font-size: 1.5em;
                }
                
                .close-modal-btn {
                    background: rgba(255, 255, 255, 0.2);
                    border: none;
                    color: white;
                    width: 35px;
                    height: 35px;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: 1.5em;
                    transition: all 0.3s;
                }
                
                .close-modal-btn:hover {
                    background: rgba(255, 255, 255, 0.3);
                    transform: rotate(90deg);
                }
                
                .modal-body {
                    padding: 30px;
                    overflow-y: auto;
                    flex: 1;
                }
                
                .report-detail-section {
                    margin-bottom: 30px;
                    padding: 20px;
                    background: #f8f9fa;
                    border-radius: 15px;
                }
                
                .report-detail-section h3 {
                    color: var(--dark);
                    margin: 0 0 15px 0;
                    font-size: 1.2em;
                    border-bottom: 2px solid #e0e0e0;
                    padding-bottom: 10px;
                }
                
                .detail-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 15px;
                }
                
                .detail-grid div {
                    padding: 10px;
                    background: white;
                    border-radius: 8px;
                }
                
                .score-badge {
                    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                    color: white;
                    padding: 5px 15px;
                    border-radius: 20px;
                    font-weight: bold;
                }
                
                .rating-details {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 10px;
                }
                
                .rating-row {
                    display: flex;
                    justify-content: space-between;
                    padding: 10px;
                    background: white;
                    border-radius: 8px;
                }
                
                .rating-value {
                    font-weight: bold;
                    padding: 2px 10px;
                    border-radius: 5px;
                }
                
                .rating-value.excellent {
                    background: rgba(0, 200, 150, 0.2);
                    color: var(--success);
                }
                
                .rating-value.good {
                    background: rgba(76, 175, 80, 0.2);
                    color: #4CAF50;
                }
                
                .rating-value.average {
                    background: rgba(255, 184, 0, 0.2);
                    color: var(--warning);
                }
                
                .rating-value.poor {
                    background: rgba(255, 152, 0, 0.2);
                    color: #FF9800;
                }
                
                .rating-value.critical {
                    background: rgba(255, 59, 59, 0.2);
                    color: var(--danger);
                }
                
                .section-notes {
                    margin-top: 15px;
                    padding: 15px;
                    background: white;
                    border-radius: 8px;
                    border-left: 3px solid var(--primary);
                }
                
                .problems-section {
                    background: #fff3cd;
                    border: 1px solid #ffeeba;
                }
                
                .problems-list {
                    display: grid;
                    gap: 15px;
                }
                
                .problem-item {
                    display: flex;
                    gap: 15px;
                    padding: 15px;
                    background: white;
                    border-radius: 8px;
                    border-left: 4px solid var(--danger);
                }
                
                .problem-icon {
                    font-size: 1.5em;
                }
                
                .notes-box {
                    padding: 15px;
                    background: white;
                    border-radius: 8px;
                    border: 1px solid #e0e0e0;
                }
                
                .modal-footer {
                    padding: 20px 30px;
                    background: #f8f9fa;
                    display: flex;
                    justify-content: flex-end;
                    gap: 10px;
                    border-top: 1px solid #e0e0e0;
                }
                
                .modal-footer button {
                    padding: 12px 25px;
                    border-radius: 10px;
                    border: none;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s;
                }
                
                .print-btn, .download-btn {
                    background: var(--primary);
                    color: white;
                }
                
                .print-btn:hover, .download-btn:hover {
                    background: var(--secondary);
                    transform: translateY(-2px);
                }
                
                .close-btn {
                    background: #e0e0e0;
                    color: var(--dark);
                }
                
                .close-btn:hover {
                    background: #d0d0d0;
                }
            `;
            document.head.appendChild(style);
        }
        
        function updateChart(selectedMonth = 'all') {
            const ctx = document.getElementById('performanceChart');
            
            // Clear existing chart if it exists
            if (window.performanceChart && typeof window.performanceChart.destroy === 'function') {
                window.performanceChart.destroy();
            }
            
            let filteredReports = reports;
            if (selectedMonth !== 'all') {
                filteredReports = reports.filter(r => {
                    const date = new Date(r.date);
                    const reportMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    return reportMonth === selectedMonth;
                });
            }
            
            if (filteredReports.length === 0) {
                // Clear the canvas if no data
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }
            
            // Prepare data
            const stores = [...new Set(filteredReports.map(r => r.store))];
            const storeData = stores.map(store => {
                const storeReports = filteredReports.filter(r => r.store === store);
                const avg = storeReports.reduce((sum, r) => sum + parseInt(r.score || 0), 0) / storeReports.length;
                return avg;
            });
            
            window.performanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: stores,
                    datasets: [{
                        label: 'Media Voti',
                        data: storeData,
                        backgroundColor: stores.map((_, i) => {
                            const score = storeData[i];
                            if (score >= 8) return 'rgba(0, 200, 150, 0.8)';
                            if (score >= 6) return 'rgba(255, 184, 0, 0.8)';
                            return 'rgba(255, 59, 59, 0.8)';
                        }),
                        borderColor: stores.map((_, i) => {
                            const score = storeData[i];
                            if (score >= 8) return 'rgba(0, 200, 150, 1)';
                            if (score >= 6) return 'rgba(255, 184, 0, 1)';
                            return 'rgba(255, 59, 59, 1)';
                        }),
                        borderWidth: 2,
                        borderRadius: 10,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: selectedMonth === 'all' ? 'Performance Generale Store' : 'Performance Store nel Periodo',
                            font: {
                                size: 18,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
