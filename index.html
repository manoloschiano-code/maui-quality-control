<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maui Poke - Controllo Qualita</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #005AA7 0%, #FC6A57 100%);
            margin: 0;
            padding: 15px;
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #FC6A57, #005AA7);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.2em;
            font-weight: bold;
        }
        
        .header p {
            margin: 0;
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        .status-bar {
            background: #d1ecf1;
            color: #0c5460;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .main-content {
            padding: 25px;
        }
        
        .store-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .store-selector label {
            font-weight: bold;
            font-size: 1.2em;
            margin-right: 15px;
            color: #333;
        }
        
        .store-selector select {
            padding: 12px 20px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            min-width: 220px;
            background: white;
        }
        
        .store-selector select:focus {
            outline: none;
            border-color: #005AA7;
            box-shadow: 0 0 5px rgba(0, 90, 167, 0.3);
        }
        
        .form-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #005AA7;
            border: 1px solid #e9ecef;
        }
        
        .form-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            font-weight: bold;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
            font-size: 1em;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #005AA7;
            box-shadow: 0 0 5px rgba(0, 90, 167, 0.3);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .rating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .rating-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #eee;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .rating-item:hover {
            transform: translateY(-2px);
            border-color: #005AA7;
        }
        
        .rating-item label {
            font-weight: bold;
            margin-bottom: 15px;
            display: block;
            color: #333;
            font-size: 1em;
        }
        
        .rating-buttons {
            display: flex;
            gap: 8px;
        }
        
        .rating-btn {
            flex: 1;
            padding: 12px 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
            font-size: 0.9em;
            font-family: Arial, sans-serif;
        }
        
        .rating-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .rating-btn.excellent {
            border-color: #27ae60;
            color: #27ae60;
        }
        
        .rating-btn.excellent.active,
        .rating-btn.excellent:hover {
            background: #27ae60;
            color: white;
        }
        
        .rating-btn.good {
            border-color: #f39c12;
            color: #f39c12;
        }
        
        .rating-btn.good.active,
        .rating-btn.good:hover {
            background: #f39c12;
            color: white;
        }
        
        .rating-btn.poor {
            border-color: #e74c3c;
            color: #e74c3c;
        }
        
        .rating-btn.poor.active,
        .rating-btn.poor:hover {
            background: #e74c3c;
            color: white;
        }
        
        .submit-section {
            text-align: center;
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #FC6A57, #005AA7);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            min-width: 250px;
            transition: all 0.3s;
            font-family: Arial, sans-serif;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .reports-section {
            background: #f1f3f4;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid #e9ecef;
        }
        
        .reports-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .report-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #005AA7;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .report-date {
            font-weight: bold;
            color: #666;
            font-size: 0.9em;
        }
        
        .report-store {
            color: #005AA7;
            font-weight: bold;
            font-size: 1em;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        input[readonly] {
            background-color: #f8f9fa !important;
            cursor: not-allowed !important;
        }
        
        #loadingMessage {
            color: #005AA7;
            font-weight: bold;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .rating-grid {
                grid-template-columns: 1fr;
            }
            
            .rating-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .rating-btn {
                padding: 14px;
                font-size: 1em;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .store-selector {
                text-align: left;
            }
            
            .store-selector select {
                width: 100%;
                margin-top: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 5px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .form-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>

    
    <div class="container">
        <div class="header">
            <h1>🌺 MAUI POKE</h1>
            <p>Sistema Controllo Qualità - Rete Store</p>
        </div>

        <div class="main-content">
            <div class="store-selector">
                <label for="storeSelect">Seleziona Store:</label>
                <select id="storeSelect">
                    <option value="">-- Scegli Store --</option>
                    <option value="Locarno">Locarno</option>
                    <option value="Lugano">Lugano</option>
                    <option value="Grancia">Grancia</option>
                    <option value="Lido">Lido</option>
                    <option value="Lugano Centro">Lugano Centro</option>
                    <option value="Mendrisio">Mendrisio</option>
                </select>
            </div>

            <form id="qualityForm">
                <div class="form-section">
                    <h3>ℹ️ Informazioni Generali</h3>
                    <div class="form-group">
                        <label for="inspector">Nome Ispettore:</label>
                        <input type="text" id="inspector" name="inspector" required placeholder="Inserisci il tuo nome">
                    </div>
                    <div class="form-group">
                        <label for="date">Data:</label>
                        <input type="date" id="date" name="date" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="time">Ora:</label>
                        <input type="time" id="time" name="time" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="personale_servizio">Personale in Servizio:</label>
                        <textarea id="personale_servizio" name="personale_servizio" placeholder="Inserisci i nomi del personale presente durante l'ispezione (es: Mario Rossi, Laura Bianchi, etc.)"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>🧹 Pulizia</h3>
                    <div class="rating-grid">
                        <div class="rating-item">
                            <label>Pulizia generale del locale</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('pulizia_generale', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('pulizia_generale', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('pulizia_generale', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="pulizia_generale" id="pulizia_generale">
                        </div>
                        
                        <div class="rating-item">
                            <label>Pulizia bancone e superfici</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('pulizia_bancone', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('pulizia_bancone', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('pulizia_bancone', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="pulizia_bancone" id="pulizia_bancone">
                        </div>
                        
                        <div class="rating-item">
                            <label>Pulizia pavimenti</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('pulizia_pavimenti', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('pulizia_pavimenti', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('pulizia_pavimenti', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="pulizia_pavimenti" id="pulizia_pavimenti">
                        </div>
                        
                        <div class="rating-item">
                            <label>Pulizia bagni</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('pulizia_bagni', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('pulizia_bagni', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('pulizia_bagni', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="pulizia_bagni" id="pulizia_bagni">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pulizia_note">Note Pulizia:</label>
                        <textarea id="pulizia_note" name="pulizia_note" placeholder="Inserisci eventuali osservazioni sulla pulizia..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="pulizia_soluzioni">Soluzioni Comunicate al Personale:</label>
                        <textarea id="pulizia_soluzioni" name="pulizia_soluzioni" placeholder="Descrivi le soluzioni specifiche comunicate al personale per migliorare la pulizia..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>👥 Comportamento Staff</h3>
                    <div class="rating-grid">
                        <div class="rating-item">
                            <label>Cortesia e disponibilità</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('comportamento_cortesia', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('comportamento_cortesia', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('comportamento_cortesia', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="comportamento_cortesia" id="comportamento_cortesia">
                        </div>
                        
                        <div class="rating-item">
                            <label>Professionalità</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('comportamento_professionalita', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('comportamento_professionalita', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('comportamento_professionalita', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="comportamento_professionalita" id="comportamento_professionalita">
                        </div>
                        
                        <div class="rating-item">
                            <label>Velocità servizio</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('comportamento_velocita', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('comportamento_velocita', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('comportamento_velocita', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="comportamento_velocita" id="comportamento_velocita">
                        </div>
                        
                        <div class="rating-item">
                            <label>Conoscenza prodotti</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('comportamento_conoscenza', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('comportamento_conoscenza', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('comportamento_conoscenza', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="comportamento_conoscenza" id="comportamento_conoscenza">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="comportamento_note">Note Comportamento:</label>
                        <textarea id="comportamento_note" name="comportamento_note" placeholder="Inserisci eventuali osservazioni sul comportamento dello staff..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="comportamento_soluzioni">Soluzioni Comunicate al Personale:</label>
                        <textarea id="comportamento_soluzioni" name="comportamento_soluzioni" placeholder="Descrivi le soluzioni specifiche comunicate al personale per migliorare il comportamento e il servizio..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>🥗 Freschezza Ingredienti</h3>
                    <div class="rating-grid">
                        <div class="rating-item">
                            <label>Pesce e proteine</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('freschezza_pesce', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('freschezza_pesce', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('freschezza_pesce', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="freschezza_pesce" id="freschezza_pesce">
                        </div>
                        
                        <div class="rating-item">
                            <label>Verdure e contorni</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('freschezza_verdure', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('freschezza_verdure', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('freschezza_verdure', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="freschezza_verdure" id="freschezza_verdure">
                        </div>
                        
                        <div class="rating-item">
                            <label>Riso e cereali</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('freschezza_riso', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('freschezza_riso', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('freschezza_riso', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="freschezza_riso" id="freschezza_riso">
                        </div>
                        
                        <div class="rating-item">
                            <label>Salse e condimenti</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('freschezza_salse', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('freschezza_salse', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('freschezza_salse', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="freschezza_salse" id="freschezza_salse">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="freschezza_note">Note Freschezza:</label>
                        <textarea id="freschezza_note" name="freschezza_note" placeholder="Inserisci eventuali osservazioni sulla freschezza degli ingredienti..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="freschezza_soluzioni">Soluzioni Comunicate al Personale:</label>
                        <textarea id="freschezza_soluzioni" name="freschezza_soluzioni" placeholder="Descrivi le soluzioni specifiche comunicate al personale per mantenere la freschezza degli ingredienti..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>👔 Divisa e Portamento</h3>
                    <div class="rating-grid">
                        <div class="rating-item">
                            <label>Pulizia divisa</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('divisa_pulizia', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('divisa_pulizia', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('divisa_pulizia', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="divisa_pulizia" id="divisa_pulizia">
                        </div>
                        
                        <div class="rating-item">
                            <label>Completezza divisa</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('divisa_completezza', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('divisa_completezza', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('divisa_completezza', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="divisa_completezza" id="divisa_completezza">
                        </div>
                        
                        <div class="rating-item">
                            <label>Portamento generale</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('divisa_portamento', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('divisa_portamento', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('divisa_portamento', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="divisa_portamento" id="divisa_portamento">
                        </div>
                        
                        <div class="rating-item">
                            <label>Igiene personale</label>
                            <div class="rating-buttons">
                                <button type="button" class="rating-btn excellent" onclick="setRating('divisa_igiene', 'excellent')">Eccellente</button>
                                <button type="button" class="rating-btn good" onclick="setRating('divisa_igiene', 'good')">Buono</button>
                                <button type="button" class="rating-btn poor" onclick="setRating('divisa_igiene', 'poor')">Scarso</button>
                            </div>
                            <input type="hidden" name="divisa_igiene" id="divisa_igiene">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="divisa_note">Note Divisa:</label>
                        <textarea id="divisa_note" name="divisa_note" placeholder="Inserisci eventuali osservazioni sulla divisa e il portamento..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="divisa_soluzioni">Soluzioni Comunicate al Personale:</label>
                        <textarea id="divisa_soluzioni" name="divisa_soluzioni" placeholder="Descrivi le soluzioni specifiche comunicate al personale per migliorare divisa e portamento..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>📝 Valutazione Complessiva</h3>
                    <div class="form-group">
                        <label for="valutazione_complessiva">Voto Complessivo (1-10):</label>
                        <select id="valutazione_complessiva" name="valutazione_complessiva" required>
                            <option value="">-- Seleziona --</option>
                            <option value="10">10 - Eccellente</option>
                            <option value="9">9 - Ottimo</option>
                            <option value="8">8 - Molto Buono</option>
                            <option value="7">7 - Buono</option>
                            <option value="6">6 - Sufficiente</option>
                            <option value="5">5 - Insufficiente</option>
                            <option value="4">4 - Scarso</option>
                            <option value="3">3 - Molto Scarso</option>
                            <option value="2">2 - Pessimo</option>
                            <option value="1">1 - Inaccettabile</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="note_generali">Note Generali:</label>
                        <textarea id="note_generali" name="note_generali" placeholder="Inserisci eventuali osservazioni generali o suggerimenti..."></textarea>
                    </div>
                </div>

                <div class="submit-section">
                    <button type="submit" class="submit-btn" id="submitBtn">📤 Salva e Invia Report</button>
                    <div id="loadingMessage" style="display: none;">
                        🚀 Invio automatico in corso...
                    </div>
                </div>
            </form>

            <div class="reports-section">
                <h3>📊 Ultimi Report Salvati</h3>
                <div id="reportsList">
                    <p style="text-align: center; color: #666; font-style: italic;">🌟 Inizia compilando il primo report di qualità!</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        emailjs.init("azBz9PrKR4ljQuq93");
        
        document.getElementById('date').valueAsDate = new Date();
        document.getElementById('time').value = new Date().toTimeString().slice(0,5);

        let reports = [];

        function loadSavedData() {
            const savedReports = localStorage.getItem('mauiQualityReports');
            if (savedReports) {
                reports = JSON.parse(savedReports);
                console.log('Caricati ' + reports.length + ' report salvati');
            }
        }

        function saveData() {
            localStorage.setItem('mauiQualityReports', JSON.stringify(reports));
            console.log('Salvati ' + reports.length + ' report');
        }

        function setRating(fieldName, rating) {
            const buttons = document.querySelectorAll('input[name="' + fieldName + '"]').item(0).parentNode.querySelectorAll('.rating-btn');
            buttons.forEach(function(btn) {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            document.getElementById(fieldName).value = rating;
        }

        function calculateOverallScore() {
            const ratings = ['pulizia_generale', 'pulizia_bancone', 'pulizia_pavimenti', 'pulizia_bagni',
                           'comportamento_cortesia', 'comportamento_professionalita', 'comportamento_velocita', 'comportamento_conoscenza',
                           'freschezza_pesce', 'freschezza_verdure', 'freschezza_riso', 'freschezza_salse',
                           'divisa_pulizia', 'divisa_completezza', 'divisa_portamento', 'divisa_igiene'];
            
            let totalScore = 0;
            let validRatings = 0;
            
            ratings.forEach(function(rating) {
                const value = document.getElementById(rating).value;
                if (value) {
                    validRatings++;
                    switch(value) {
                        case 'excellent': totalScore += 10; break;
                        case 'good': totalScore += 7; break;
                        case 'poor': totalScore += 4; break;
                    }
                }
            });
            
            if (validRatings > 0) {
                const averageScore = Math.round(totalScore / validRatings);
                document.getElementById('valutazione_complessiva').value = averageScore;
            }
        }

        function sendReportEmailReal(reportData) {
            console.log('Sending email...');
            
            updateReportsList();
            
            try {
                sendViaEmailJS(reportData);
            } catch (error) {
                console.error('EmailJS failed:', error);
                sendEmailDirectly(reportData);
            }
            
            resetSubmitButton();
        }

        function sendViaEmailJS(reportData) {
            const templateParams = {
                to_email: 'manolo.schiano@mauipoke.ch',
                cc_email: 'antonello.romeo@mauipoke.ch',
                subject: '🌺 MAUI QUALITY REPORT - ' + reportData.store + ' - ' + new Date(reportData.date).toLocaleDateString('it-IT'),
                store_name: reportData.store,
                inspector_name: reportData.inspector,
                report_date: new Date(reportData.date).toLocaleDateString('it-IT'),
                report_time: reportData.time,
                overall_score: reportData.valutazione_complessiva || 'Non specificato',
                message: generateEmailBody(reportData)
            };

            emailjs.send('service_cysrzkx', 'template_j203617', templateParams).then(function(result) {
                console.log('EmailJS SUCCESS:', result);
                showSuccessMessage(reportData, 'emailjs');
            }).catch(function(error) {
                console.error('EmailJS ERROR:', error);
                sendEmailDirectly(reportData);
            });
        }

        function sendEmailDirectly(reportData) {
            const subject = '🌺 MAUI QUALITY REPORT - ' + reportData.store + ' - ' + new Date(reportData.date).toLocaleDateString('it-IT');
            const body = generateEmailBody(reportData);
            const mailtoLink = 'mailto:manolo.schiano@mauipoke.ch,antonello.romeo@mauipoke.ch?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);
            window.open(mailtoLink, '_blank');
            showSuccessMessage(reportData, 'direct');
        }

        function generateEmailBody(data) {
            return '🌺 MAUI POKE - CONTROLLO QUALITÀ\n' +
                   '═══════════════════════════════════════\n\n' +
                   '📍 STORE: ' + data.store + '\n' +
                   '👤 ISPETTORE: ' + data.inspector + '\n' +
                   '📅 DATA: ' + new Date(data.date).toLocaleDateString('it-IT') + ' alle ' + data.time + '\n' +
                   (data.personale_servizio ? '👥 PERSONALE: ' + data.personale_servizio + '\n' : '') +
                   '\n⭐ VOTO COMPLESSIVO: ' + data.valutazione_complessiva + '/10\n\n' +
                   
                   '🧹 PULIZIA\n' +
                   '─────────────────────────\n' +
                   '• Generale: ' + translateRating(data.pulizia_generale) + '\n' +
                   '• Bancone: ' + translateRating(data.pulizia_bancone) + '\n' +
                   '• Pavimenti: ' + translateRating(data.pulizia_pavimenti) + '\n' +
                   '• Bagni: ' + translateRating(data.pulizia_bagni) + '\n' +
                   (data.pulizia_note ? '📝 Note: ' + data.pulizia_note + '\n' : '') +
                   (data.pulizia_soluzioni ? '🔧 Soluzioni: ' + data.pulizia_soluzioni + '\n' : '') + '\n' +
                   
                   '👥 COMPORTAMENTO STAFF\n' +
                   '─────────────────────────\n' +
                   '• Cortesia: ' + translateRating(data.comportamento_cortesia) + '\n' +
                   '• Professionalità: ' + translateRating(data.comportamento_professionalita) + '\n' +
                   '• Velocità: ' + translateRating(data.comportamento_velocita) + '\n' +
                   '• Conoscenza: ' + translateRating(data.comportamento_conoscenza) + '\n' +
                   (data.comportamento_note ? '📝 Note: ' + data.comportamento_note + '\n' : '') +
                   (data.comportamento_soluzioni ? '🔧 Soluzioni: ' + data.comportamento_soluzioni + '\n' : '') + '\n' +
                   
                   '🥗 FRESCHEZZA INGREDIENTI\n' +
                   '─────────────────────────\n' +
                   '• Pesce/Proteine: ' + translateRating(data.freschezza_pesce) + '\n' +
                   '• Verdure: ' + translateRating(data.freschezza_verdure) + '\n' +
                   '• Riso/Cereali: ' + translateRating(data.freschezza_riso) + '\n' +
                   '• Salse: ' + translateRating(data.freschezza_salse) + '\n' +
                   (data.freschezza_note ? '📝 Note: ' + data.freschezza_note + '\n' : '') +
                   (data.freschezza_soluzioni ? '🔧 Soluzioni: ' + data.freschezza_soluzioni + '\n' : '') + '\n' +
                   
                   '👔 DIVISA E PORTAMENTO\n' +
                   '─────────────────────────\n' +
                   '• Pulizia divisa: ' + translateRating(data.divisa_pulizia) + '\n' +
                   '• Completezza: ' + translateRating(data.divisa_completezza) + '\n' +
                   '• Portamento: ' + translateRating(data.divisa_portamento) + '\n' +
                   '• Igiene: ' + translateRating(data.divisa_igiene) + '\n' +
                   (data.divisa_note ? '📝 Note: ' + data.divisa_note + '\n' : '') +
                   (data.divisa_soluzioni ? '🔧 Soluzioni: ' + data.divisa_soluzioni + '\n' : '') + '\n' +
                   
                   (data.note_generali ? '📋 NOTE GENERALI\n─────────────────────────\n' + data.note_generali + '\n\n' : '') +
                   '═══════════════════════════════════════\n' +
                   '🤖 Report generato automaticamente\n' +
                   '📱 Maui Quality Control System';
        }

        function translateRating(rating) {
            switch(rating) {
                case 'excellent': return 'Eccellente';
                case 'good': return 'Buono';
                case 'poor': return 'Scarso';
                default: return 'Non valutato';
            }
        }

        function showSuccessMessage(reportData, emailStatus) {
            const existingMessages = document.querySelectorAll('.success, .warning');
            existingMessages.forEach(function(msg) {
                msg.remove();
            });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success';
            
            if (emailStatus === 'emailjs') {
                messageDiv.innerHTML = '🎉 Report inviato con successo!<br>' +
                                       'Store: <strong>' + reportData.store + '</strong><br>' +
                                       'Voto: <strong>' + reportData.valutazione_complessiva + '/10</strong><br>' +
                                       'Email inviata automaticamente ai manager';
            } else {
                messageDiv.innerHTML = '✅ Report salvato e email aperta!<br>' +
                                       'Store: <strong>' + reportData.store + '</strong><br>' +
                                       'Voto: <strong>' + reportData.valutazione_complessiva + '/10</strong><br>' +
                                       'Completa l\'invio nel client email';
            }
            
            document.querySelector('.submit-section').appendChild(messageDiv);
            
            setTimeout(function() {
                messageDiv.remove();
            }, 6000);
            
            resetForm();
        }

        function resetForm() {
            document.getElementById('qualityForm').reset();
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('time').value = new Date().toTimeString().slice(0,5);
            document.getElementById('storeSelect').value = '';
            
            document.querySelectorAll('.rating-btn.active').forEach(function(btn) {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('input[type="hidden"]').forEach(function(input) {
                input.value = '';
            });
        }

        function updateReportsList() {
            const reportsList = document.getElementById('reportsList');
            
            if (reports.length === 0) {
                reportsList.innerHTML = '<p style="text-align: center; color: #666; font-style: italic;">🌟 Inizia compilando il primo report!</p>';
                return;
            }

            reportsList.innerHTML = reports
                .sort(function(a, b) {
                    return new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time);
                })
                .slice(0, 10)
                .map(function(report) {
                    return '<div class="report-item">' +
                           '<div>' +
                           '<div class="report-date">' + new Date(report.date).toLocaleDateString('it-IT') + ' - ' + report.time + '</div>' +
                           '<div class="report-store">' + report.store + '</div>' +
                           '</div>' +
                           '<div style="text-align: right;">' +
                           '<div style="font-weight: bold; color: ' + getScoreColor(report.valutazione_complessiva) + ';">' +
                           report.valutazione_complessiva + '/10' +
                           '</div>' +
                           '<div style="font-size: 0.9em; color: #666;">' +
                           report.inspector +
                           '</div>' +
                           '</div>' +
                           '</div>';
                }).join('');
        }

        function getScoreColor(score) {
            if (score >= 8) return '#27ae60';
            if (score >= 6) return '#f39c12';
            return '#e74c3c';
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            const loadingMsg = document.getElementById('loadingMessage');
            const submitBtn = document.getElementById('submitBtn');
            
            loadingMsg.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.textContent = '🚀 Invio in corso...';
            
            const storeSelect = document.getElementById('storeSelect');
            
            if (!storeSelect.value) {
                alert('⚠️ Seleziona uno store!');
                resetSubmitButton();
                return false;
            }

            const inspector = document.getElementById('inspector').value;
            if (!inspector) {
                alert('⚠️ Inserisci il nome ispettore!');
                resetSubmitButton();
                return false;
            }

            const reportData = {
                id: Date.now(),
                store: storeSelect.value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                inspector: inspector,
                personale_servizio: document.getElementById('personale_servizio').value,
                
                pulizia_generale: document.getElementById('pulizia_generale').value,
                pulizia_bancone: document.getElementById('pulizia_bancone').value,
                pulizia_pavimenti: document.getElementById('pulizia_pavimenti').value,
                pulizia_bagni: document.getElementById('pulizia_bagni').value,
                pulizia_note: document.getElementById('pulizia_note').value,
                pulizia_soluzioni: document.getElementById('pulizia_soluzioni').value,
                
                comportamento_cortesia: document.getElementById('comportamento_cortesia').value,
                comportamento_professionalita: document.getElementById('comportamento_professionalita').value,
                comportamento_velocita: document.getElementById('comportamento_velocita').value,
                comportamento_conoscenza: document.getElementById('comportamento_conoscenza').value,
                comportamento_note: document.getElementById('comportamento_note').value,
                comportamento_soluzioni: document.getElementById('comportamento_soluzioni').value,
                
                freschezza_pesce: document.getElementById('freschezza_pesce').value,
                freschezza_verdure: document.getElementById('freschezza_verdure').value,
                freschezza_riso: document.getElementById('freschezza_riso').value,
                freschezza_salse: document.getElementById('freschezza_salse').value,
                freschezza_note: document.getElementById('freschezza_note').value,
                freschezza_soluzioni: document.getElementById('freschezza_soluzioni').value,
                
                divisa_pulizia: document.getElementById('divisa_pulizia').value,
                divisa_completezza: document.getElementById('divisa_completezza').value,
                divisa_portamento: document.getElementById('divisa_portamento').value,
                divisa_igiene: document.getElementById('divisa_igiene').value,
                divisa_note: document.getElementById('divisa_note').value,
                divisa_soluzioni: document.getElementById('divisa_soluzioni').value,
                
                valutazione_complessiva: document.getElementById('valutazione_complessiva').value,
                note_generali: document.getElementById('note_generali').value
            };

            if (!reportData.valutazione_complessiva) {
                calculateOverallScore();
                reportData.valutazione_complessiva = document.getElementById('valutazione_complessiva').value;
            }

            reports.push(reportData);
            saveData();
            sendReportEmailReal(reportData);
            
            return false;
        }
        
        function resetSubmitButton() {
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitBtn').textContent = '📤 Salva e Invia Report';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            updateReportsList();
            
            const form = document.getElementById('qualityForm');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }
            
            console.log('🌺 Maui Quality Control - Ready!');
        });

        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('rating-btn')) {
                setTimeout(calculateOverallScore, 100);
            }
        });
    </script>
</body>
</html>
