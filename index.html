<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maui Poke - Quality Control System 2.0</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        :root {
            --primary: #005AA7;
            --secondary: #FC6A57;
            --success: #00C896;
            --warning: #FFB800;
            --danger: #FF3B3B;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-dark: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gradient-dark);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Animated Background */
        .animated-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(270deg, #005AA7, #FC6A57, #00C896, #764ba2);
            background-size: 800% 800%;
            animation: gradientShift 15s ease infinite;
            opacity: 0.1;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Floating Particles */
        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            from {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            to {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0;
            }
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.8s ease;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .header h1 {
            font-size: 3.5em;
            font-weight: 900;
            background: linear-gradient(135deg, #fff 0%, #FC6A57 50%, #00C896 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -2px;
            position: relative;
            z-index: 1;
            animation: glow 3s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(252, 106, 87, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(252, 106, 87, 0.8)); }
        }
        
        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2em;
            font-weight: 300;
            position: relative;
            z-index: 1;
        }
        
        /* Store Selector */
        .store-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.8s ease 0.2s both;
        }
        
        .store-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .store-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .store-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .store-card:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .store-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        
        .store-card.selected {
            background: linear-gradient(135deg, var(--success), #00a878);
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 200, 150, 0.4);
        }
        
        .store-card.selected::after {
            content: '✓';
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 1.5em;
        }
        
        /* Form Sections */
        .form-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.8s ease both;
            position: relative;
            overflow: hidden;
        }
        
        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-1);
            animation: colorWave 3s ease-in-out infinite;
        }
        
        @keyframes colorWave {
            0%, 100% { background: var(--gradient-1); }
            33% { background: var(--gradient-2); }
            66% { background: var(--gradient-3); }
        }
        
        .form-section h3 {
            color: var(--dark);
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-1);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            animation: iconFloat 3s ease-in-out infinite;
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Advanced Rating System */
        .rating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .rating-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .rating-item::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(252, 106, 87, 0.1) 0%, transparent 70%);
            transition: all 0.5s;
        }
        
        .rating-item:hover::before {
            top: -150%;
            left: -150%;
        }
        
        .rating-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }
        
        .rating-item label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            display: block;
            font-size: 1.1em;
        }
        
        /* Star Rating System */
        .star-rating {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .star {
            font-size: 2em;
            color: #ddd;
            cursor: pointer;
            transition: all 0.3s;
            transform-origin: center;
        }
        
        .star:hover {
            transform: scale(1.2);
        }
        
        .star.active {
            color: #FFD700;
            animation: starPop 0.5s ease;
        }
        
        @keyframes starPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        
        /* Modern Input Styles */
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid transparent;
            border-radius: 15px;
            font-size: 1em;
            background: #f8f9fa;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 5px 20px rgba(0, 90, 167, 0.2);
            transform: translateY(-2px);
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* Progress Indicator */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-1);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Submit Button */
        .submit-section {
            text-align: center;
            margin: 40px 0;
            animation: slideUp 0.8s ease 0.6s both;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 1.3em;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.4s;
            box-shadow: 0 10px 30px rgba(0, 90, 167, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .submit-btn:hover::before {
            width: 400px;
            height: 400px;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 50px rgba(0, 90, 167, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .submit-btn.loading {
            animation: pulse 1.5s infinite;
        }
        
        /* Dashboard Section */
        .dashboard {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 35px;
            margin-top: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.8s ease 0.8s both;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Chart Container */
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin-top: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        #performanceChart {
            max-width: 100%;
            height: 300px;
        }
        
        /* Report Cards */
        .reports-grid {
            display: grid;
            gap: 20px;
            margin-top: 25px;
        }
        
        .report-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-left: 5px solid;
            animation: slideRight 0.5s ease both;
        }
        
        .report-card:hover {
            transform: translateX(10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        
        .report-card.excellent { border-left-color: var(--success); }
        .report-card.good { border-left-color: var(--warning); }
        .report-card.poor { border-left-color: var(--danger); }
        
        .report-info h4 {
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 1.2em;
        }
        
        .report-meta {
            color: #666;
            font-size: 0.9em;
        }
        
        .report-score {
            font-size: 2em;
            font-weight: 900;
            padding: 15px;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }
        
        /* Success Message */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            text-align: center;
            animation: successPop 0.5s ease forwards;
        }
        
        @keyframes successPop {
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--success) 0%, #00a878 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 3em;
            color: white;
            animation: checkmark 0.8s ease 0.3s both;
        }
        
        @keyframes checkmark {
            0% { transform: scale(0) rotate(0); }
            50% { transform: scale(1.2) rotate(360deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        
        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1999;
            display: none;
        }
        
        .overlay.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideRight {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }
            
            .store-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .rating-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .submit-btn {
                padding: 18px 40px;
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .form-section {
                padding: 25px 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <div class="particles" id="particles"></div>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>MAUI POKE</h1>
            <p>Sistema Controllo Qualità - Rete Store</p>
        </div>
        
        <div class="store-selector">
            <h3 style="color: var(--dark); margin-bottom: 20px; font-size: 1.5em;">📍 Seleziona Store</h3>
            <div class="store-grid">
                <div class="store-card" data-store="Locarno">Locarno</div>
                <div class="store-card" data-store="Lugano">Lugano</div>
                <div class="store-card" data-store="Grancia">Grancia</div>
                <div class="store-card" data-store="Lido">Lido</div>
                <div class="store-card" data-store="Lugano Centro">Lugano Centro</div>
                <div class="store-card" data-store="Mendrisio">Mendrisio</div>
            </div>
        </div>
        
        <form id="qualityForm">
            <div class="form-section">
                <h3>
                    <div class="section-icon">ℹ️</div>
                    Informazioni Generali
                </h3>
                <div class="form-group">
                    <label for="inspector">Nome Ispettore</label>
                    <input type="text" id="inspector" name="inspector" required placeholder="Inserisci il tuo nome">
                </div>
                <div class="form-group">
                    <label for="date">Data Ispezione</label>
                    <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="time">Ora Ispezione</label>
                    <input type="time" id="time" name="time" required>
                </div>
                <div class="form-group">
                    <label for="personale">Personale in Servizio</label>
                    <textarea id="personale" name="personale" placeholder="Elenca il personale presente durante l'ispezione"></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>
                    <div class="section-icon">🧹</div>
                    Valutazione Pulizia
                </h3>
                <div class="rating-grid">
                    <div class="rating-item">
                        <label>Pulizia Generale</label>
                        <div class="star-rating" data-field="pulizia_generale">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Bancone e Superfici</label>
                        <div class="star-rating" data-field="pulizia_bancone">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Pavimenti</label>
                        <div class="star-rating" data-field="pulizia_pavimenti">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Servizi Igienici</label>
                        <div class="star-rating" data-field="pulizia_bagni">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="pulizia_note">Note e Osservazioni</label>
                    <textarea id="pulizia_note" name="pulizia_note" placeholder="Dettagli specifici sulla pulizia..."></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>
                    <div class="section-icon">👥</div>
                    Comportamento Staff
                </h3>
                <div class="rating-grid">
                    <div class="rating-item">
                        <label>Cortesia</label>
                        <div class="star-rating" data-field="staff_cortesia">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Professionalità</label>
                        <div class="star-rating" data-field="staff_professionalita">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Velocità Servizio</label>
                        <div class="star-rating" data-field="staff_velocita">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Conoscenza Prodotti</label>
                        <div class="star-rating" data-field="staff_conoscenza">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="staff_note">Note e Osservazioni</label>
                    <textarea id="staff_note" name="staff_note" placeholder="Dettagli sul comportamento dello staff..."></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>
                    <div class="section-icon">🥗</div>
                    Freschezza Ingredienti
                </h3>
                <div class="rating-grid">
                    <div class="rating-item">
                        <label>Pesce e Proteine</label>
                        <div class="star-rating" data-field="fresh_pesce">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Verdure</label>
                        <div class="star-rating" data-field="fresh_verdure">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Riso e Cereali</label>
                        <div class="star-rating" data-field="fresh_riso">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                    <div class="rating-item">
                        <label>Salse e Condimenti</label>
                        <div class="star-rating" data-field="fresh_salse">
                            <span class="star" data-value="1">⭐</span>
                            <span class="star" data-value="2">⭐</span>
                            <span class="star" data-value="3">⭐</span>
                            <span class="star" data-value="4">⭐</span>
                            <span class="star" data-value="5">⭐</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="fresh_note">Note e Osservazioni</label>
                    <textarea id="fresh_note" name="fresh_note" placeholder="Dettagli sulla freschezza degli ingredienti..."></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>
                    <div class="section-icon">📝</div>
                    Valutazione Finale
                </h3>
                <div class="form-group">
                    <label for="valutazione_finale">Voto Complessivo (1-10)</label>
                    <select id="valutazione_finale" name="valutazione_finale" required>
                        <option value="">Seleziona un voto...</option>
                        <option value="10">10 - Eccellente</option>
                        <option value="9">9 - Ottimo</option>
                        <option value="8">8 - Molto Buono</option>
                        <option value="7">7 - Buono</option>
                        <option value="6">6 - Sufficiente</option>
                        <option value="5">5 - Insufficiente</option>
                        <option value="4">4 - Scarso</option>
                        <option value="3">3 - Molto Scarso</option>
                        <option value="2">2 - Pessimo</option>
                        <option value="1">1 - Inaccettabile</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="note_finali">Note Generali e Raccomandazioni</label>
                    <textarea id="note_finali" name="note_finali" placeholder="Osservazioni finali e suggerimenti per il miglioramento..."></textarea>
                </div>
            </div>
            
            <div class="submit-section">
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="btnText">INVIA REPORT</span>
                </button>
            </div>
        </form>
        
        <div class="dashboard">
            <h3 style="color: var(--dark); margin-bottom: 30px; font-size: 1.8em;">📊 Dashboard Analytics</h3>
            
            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="stat-number" id="totalReports">0</div>
                    <div class="stat-label">Report Totali</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="stat-number" id="avgScore">0.0</div>
                    <div class="stat-label">Media Voti</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="stat-number" id="bestStore">-</div>
                    <div class="stat-label">Miglior Store</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <div class="stat-number" id="recentInspections">0</div>
                    <div class="stat-label">Ispezioni Mese</div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
            
            <h4 style="color: var(--dark); margin: 30px 0 20px; font-size: 1.4em;">📝 Report Recenti</h4>
            <div class="reports-grid" id="recentReports">
                <p style="text-align: center; color: #999;">Nessun report disponibile</p>
            </div>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    <div class="success-message" id="successMessage" style="display: none;">
        <div class="success-icon">✓</div>
        <h2 style="color: var(--dark); margin-bottom: 10px;">Report Inviato!</h2>
        <p style="color: #666;">Il report è stato salvato e inviato con successo.</p>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // Initialize EmailJS
        emailjs.init("azBz9PrKR4ljQuq93");
        
        // State Management
        let selectedStore = '';
        let ratings = {};
        let reports = JSON.parse(localStorage.getItem('mauiReports') || '[]');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeParticles();
            initializeDateTime();
            initializeStoreSelector();
            initializeRatings();
            initializeForm();
            updateDashboard();
            updateProgressBar();
        });
        
        // Particles Animation
        function initializeParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // DateTime
        function initializeDateTime() {
            const now = new Date();
            document.getElementById('date').valueAsDate = now;
            document.getElementById('time').value = now.toTimeString().slice(0, 5);
        }
        
        // Store Selector
        function initializeStoreSelector() {
            document.querySelectorAll('.store-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.store-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedStore = this.dataset.store;
                    updateProgressBar();
                });
            });
        }
        
        // Star Ratings
        function initializeRatings() {
            document.querySelectorAll('.star-rating').forEach(rating => {
                const field = rating.dataset.field;
                rating.addEventListener('click', function(e) {
                    if (e.target.classList.contains('star')) {
                        const value = parseInt(e.target.dataset.value);
                        ratings[field] = value;
                        updateStars(rating, value);
                        updateProgressBar();
                        calculateAutoScore();
                    }
                });
            });
        }
        
        function updateStars(ratingElement, value) {
            const stars = ratingElement.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < value) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }
        
        // Auto Calculate Score
        function calculateAutoScore() {
            const ratingValues = Object.values(ratings);
            if (ratingValues.length > 0) {
                const avg = ratingValues.reduce((a, b) => a + b, 0) / ratingValues.length;
                const score = Math.round(avg * 2);
                document.getElementById('valutazione_finale').value = score;
            }
        }
        
        // Progress Bar
        function updateProgressBar() {
            const totalFields = 17; // Total fields to complete
            let completed = 0;
            
            if (selectedStore) completed++;
            if (document.getElementById('inspector').value) completed++;
            if (document.getElementById('date').value) completed++;
            if (document.getElementById('time').value) completed++;
            completed += Object.keys(ratings).length;
            if (document.getElementById('valutazione_finale').value) completed++;
            
            const progress = (completed / totalFields) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }
        
        // Form Submission
        function initializeForm() {
            document.getElementById('qualityForm').addEventListener('submit', handleSubmit);
            
            // Update progress on input
            document.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('input', updateProgressBar);
            });
        }
        
        function handleSubmit(e) {
            e.preventDefault();
            
            if (!selectedStore) {
                alert('Seleziona uno store!');
                return;
            }
            
            const btn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            
            btn.classList.add('loading');
            btnText.textContent = 'INVIO IN CORSO...';
            btn.disabled = true;
            
            const formData = new FormData(e.target);
            const report = {
                id: Date.now(),
                store: selectedStore,
                date: formData.get('date'),
                time: formData.get('time'),
                inspector: formData.get('inspector'),
                personale: formData.get('personale'),
                ratings: {...ratings},
                score: formData.get('valutazione_finale'),
                notes: {
                    pulizia: formData.get('pulizia_note'),
                    staff: formData.get('staff_note'),
                    fresh: formData.get('fresh_note'),
                    final: formData.get('note_finali')
                }
            };
            
            // Save report
            reports.push(report);
            localStorage.setItem('mauiReports', JSON.stringify(reports));
            
            // Send email
            sendEmail(report);
            
            // Show success
            setTimeout(() => {
                showSuccess();
                resetForm();
                updateDashboard();
                btn.classList.remove('loading');
                btnText.textContent = 'INVIA REPORT';
                btn.disabled = false;
            }, 1500);
        }
        
        function sendEmail(report) {
            const ratingToText = (value) => {
                const labels = ['Inaccettabile', 'Scarso', 'Sufficiente', 'Buono', 'Eccellente'];
                return labels[value - 1] || 'Non valutato';
            };
            
            // Prepara tutti i parametri per il template EmailJS
            const templateParams = {
                to_email: 'manolo.schiano@mauipoke.ch',
                cc_email: 'antonello.romeo@mauipoke.ch',
                subject: `🌺 Quality Report - ${report.store} - ${new Date(report.date).toLocaleDateString('it-IT')}`,
                
                // Dati base
                store_name: report.store,
                inspector_name: report.inspector,
                report_date: new Date(report.date).toLocaleDateString('it-IT'),
                report_time: report.time,
                overall_score: report.score,
                personale: report.personale || 'Non specificato',
                
                // Valutazioni Pulizia
                pulizia_generale: ratingToText(report.ratings.pulizia_generale),
                pulizia_bancone: ratingToText(report.ratings.pulizia_bancone),
                pulizia_pavimenti: ratingToText(report.ratings.pulizia_pavimenti),
                pulizia_bagni: ratingToText(report.ratings.pulizia_bagni),
                pulizia_note: report.notes.pulizia || 'Nessuna nota',
                
                // Valutazioni Staff
                staff_cortesia: ratingToText(report.ratings.staff_cortesia),
                staff_professionalita: ratingToText(report.ratings.staff_professionalita),
                staff_velocita: ratingToText(report.ratings.staff_velocita),
                staff_conoscenza: ratingToText(report.ratings.staff_conoscenza),
                staff_note: report.notes.staff || 'Nessuna nota',
                
                // Valutazioni Freschezza
                fresh_pesce: ratingToText(report.ratings.fresh_pesce),
                fresh_verdure: ratingToText(report.ratings.fresh_verdure),
                fresh_riso: ratingToText(report.ratings.fresh_riso),
                fresh_salse: ratingToText(report.ratings.fresh_salse),
                fresh_note: report.notes.fresh || 'Nessuna nota',
                
                // Note finali
                note_finali: report.notes.final || 'Nessuna nota generale'
            };
            
            // Invia con EmailJS usando il template con variabili
            emailjs.send('service_cysrzkx', 'template_j203617', templateParams)
                .then(() => {
                    console.log('Email sent successfully with parameters');
                })
                .catch(error => {
                    console.error('EmailJS error:', error);
                    // Fallback: apri client email con il report formattato
                    const emailBody = formatEmailBody(report);
                    const subject = encodeURIComponent(templateParams.subject);
                    const body = encodeURIComponent(emailBody);
                    window.open(`mailto:${templateParams.to_email},${templateParams.cc_email}?subject=${subject}&body=${body}`);
                });
        }
        
        function formatEmailBody(report) {
            const ratingToText = (value) => {
                const labels = ['Inaccettabile', 'Scarso', 'Sufficiente', 'Buono', 'Eccellente'];
                return labels[value - 1] || 'N/A';
            };
            
            return `
🌺 MAUI POKE - QUALITY CONTROL REPORT
═══════════════════════════════════════

📍 STORE: ${report.store}
👤 ISPETTORE: ${report.inspector}
📅 DATA: ${new Date(report.date).toLocaleDateString('it-IT')} ${report.time}
${report.personale ? `👥 PERSONALE: ${report.personale}` : ''}

⭐ VOTO COMPLESSIVO: ${report.score}/10

🧹 PULIZIA
─────────────────────────
• Generale: ${ratingToText(report.ratings.pulizia_generale)}
• Bancone: ${ratingToText(report.ratings.pulizia_bancone)}
• Pavimenti: ${ratingToText(report.ratings.pulizia_pavimenti)}
• Bagni: ${ratingToText(report.ratings.pulizia_bagni)}
${report.notes.pulizia ? `📝 Note: ${report.notes.pulizia}` : ''}

👥 STAFF
─────────────────────────
• Cortesia: ${ratingToText(report.ratings.staff_cortesia)}
• Professionalità: ${ratingToText(report.ratings.staff_professionalita)}
• Velocità: ${ratingToText(report.ratings.staff_velocita)}
• Conoscenza: ${ratingToText(report.ratings.staff_conoscenza)}
${report.notes.staff ? `📝 Note: ${report.notes.staff}` : ''}

🥗 FRESCHEZZA
─────────────────────────
• Pesce: ${ratingToText(report.ratings.fresh_pesce)}
• Verdure: ${ratingToText(report.ratings.fresh_verdure)}
• Riso: ${ratingToText(report.ratings.fresh_riso)}
• Salse: ${ratingToText(report.ratings.fresh_salse)}
${report.notes.fresh ? `📝 Note: ${report.notes.fresh}` : ''}

${report.notes.final ? `📋 NOTE FINALI\n─────────────────────────\n${report.notes.final}` : ''}

═══════════════════════════════════════
🤖 Report generato automaticamente
📱 Maui Quality Control System 2.0
            `;
        }
        
        function showSuccess() {
            const overlay = document.getElementById('overlay');
            const successMsg = document.getElementById('successMessage');
            
            overlay.classList.add('active');
            successMsg.style.display = 'block';
            
            setTimeout(() => {
                overlay.classList.remove('active');
                successMsg.style.display = 'none';
            }, 3000);
        }
        
        function resetForm() {
            document.getElementById('qualityForm').reset();
            document.querySelectorAll('.store-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
            selectedStore = '';
            ratings = {};
            initializeDateTime();
            updateProgressBar();
        }
        
        // Dashboard
        function updateDashboard() {
            // Update stats
            document.getElementById('totalReports').textContent = reports.length;
            
            if (reports.length > 0) {
                // Average score
                const avgScore = reports.reduce((sum, r) => sum + parseInt(r.score), 0) / reports.length;
                document.getElementById('avgScore').textContent = avgScore.toFixed(1);
                
                // Best store
                const storeScores = {};
                reports.forEach(r => {
                    if (!storeScores[r.store]) {
                        storeScores[r.store] = { total: 0, count: 0 };
                    }
                    storeScores[r.store].total += parseInt(r.score);
                    storeScores[r.store].count++;
                });
                
                let bestStore = '';
                let bestAvg = 0;
                Object.keys(storeScores).forEach(store => {
                    const avg = storeScores[store].total / storeScores[store].count;
                    if (avg > bestAvg) {
                        bestAvg = avg;
                        bestStore = store;
                    }
                });
                document.getElementById('bestStore').textContent = bestStore || '-';
                
                // Recent inspections (this month)
                const thisMonth = new Date().getMonth();
                const recentCount = reports.filter(r => new Date(r.date).getMonth() === thisMonth).length;
                document.getElementById('recentInspections').textContent = recentCount;
                
                // Update recent reports
                updateRecentReports();
                
                // Update chart
                updateChart();
            }
        }
        
        function updateRecentReports() {
            const container = document.getElementById('recentReports');
            const recent = reports.slice(-5).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">Nessun report disponibile</p>';
                return;
            }
            
            container.innerHTML = recent.map(report => {
                const score = parseInt(report.score);
                const scoreClass = score >= 8 ? 'excellent' : score >= 6 ? 'good' : 'poor';
                
                return `
                    <div class="report-card ${scoreClass}">
                        <div class="report-info">
                            <h4>${report.store}</h4>
                            <div class="report-meta">
                                ${new Date(report.date).toLocaleDateString('it-IT')} - ${report.inspector}
                            </div>
                        </div>
                        <div class="report-score" style="color: ${score >= 8 ? 'var(--success)' : score >= 6 ? 'var(--warning)' : 'var(--danger)'}">
                            ${score}/10
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateChart() {
            const ctx = document.getElementById('performanceChart');
            
            // Prepare data
            const stores = [...new Set(reports.map(r => r.store))];
            const storeData = stores.map(store => {
                const storeReports = reports.filter(r => r.store === store);
                const avg = storeReports.reduce((sum, r) => sum + parseInt(r.score), 0) / storeReports.length;
                return avg;
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: stores,
                    datasets: [{
                        label: 'Media Voti',
                        data: storeData,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 10,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Performance per Store',
                            font: {
                                size: 18,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
